<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主页编辑器 ✏️</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50">
    <div id="app" class="h-screen flex flex-col md:flex-row overflow-hidden">
        
        <!-- Sidebar: Editor Controls -->
        <div class="w-full md:w-1/3 bg-white border-r border-gray-200 flex flex-col h-full shadow-lg z-20">
            <div class="p-6 border-b border-gray-100 bg-pink-50">
                <h1 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <i data-lucide="edit-3" class="w-5 h-5"></i> 编辑我的主页
                </h1>
                <p class="text-xs text-gray-500 mt-1">修改后点击保存，替换 data/profile.json 文件</p>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-8">
                
                <!-- Basic Info Section -->
                <section>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">基本信息</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">昵称</label>
                            <input v-model="profile.basicInfo.nickname" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-pink-200 focus:border-pink-300 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">头像链接</label>
                            <input v-model="profile.basicInfo.avatar" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-pink-200 outline-none transition-all text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">个性签名</label>
                            <textarea v-model="profile.basicInfo.signature" rows="2" class="w-full px-4 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-pink-200 outline-none transition-all"></textarea>
                        </div>
                    </div>
                </section>

                <!-- Hobbies Section -->
                <section>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 flex justify-between items-center">
                        爱好标签
                        <button @click="addHobby" class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded transition-colors">+ 添加</button>
                    </h3>
                    <div class="space-y-2">
                        <div v-for="(hobby, index) in profile.hobbies" :key="index" class="flex gap-2">
                            <input v-model="profile.hobbies[index]" type="text" class="flex-1 px-3 py-2 rounded-lg border border-gray-200 focus:ring-2 focus:ring-pink-200 outline-none text-sm">
                            <button @click="removeHobby(index)" class="text-red-400 hover:text-red-600 p-2">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Moods Section -->
                <section>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 flex justify-between items-center">
                        心情墙
                        <button @click="addMood" class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded transition-colors">+ 写心情</button>
                    </h3>
                    <div class="space-y-4">
                        <div v-for="(mood, index) in profile.moods" :key="mood.id" class="p-4 bg-gray-50 rounded-xl border border-gray-100">
                            <div class="flex justify-between mb-2">
                                <span class="text-xs font-mono text-gray-400">#{{ index + 1 }}</span>
                                <button @click="removeMood(index)" class="text-red-400 hover:text-red-600">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <textarea v-model="mood.content" rows="2" class="w-full px-3 py-2 rounded-lg border border-gray-200 mb-2 text-sm" placeholder="今天发生了什么..."></textarea>
                            <div class="flex gap-2">
                                <input v-model="mood.date" type="date" class="w-1/2 px-3 py-1 rounded-lg border border-gray-200 text-xs">
                                <select v-model="mood.color" class="w-1/2 px-3 py-1 rounded-lg border border-gray-200 text-xs">
                                    <option value="bg-pink-100">粉色</option>
                                    <option value="bg-blue-100">蓝色</option>
                                    <option value="bg-yellow-100">黄色</option>
                                    <option value="bg-green-100">绿色</option>
                                    <option value="bg-purple-100">紫色</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <!-- Footer Actions -->
            <div class="p-6 border-t border-gray-200 bg-white">
                <button @click="saveProfile" class="w-full bg-gray-900 hover:bg-gray-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg transform active:scale-95 transition-all flex justify-center items-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    保存配置 (profile.json)
                </button>
            </div>
        </div>

        <!-- Main: Live Preview -->
        <div class="flex-1 bg-gray-100 overflow-y-auto relative">
            <div class="absolute top-4 right-4 bg-white/80 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-gray-500 shadow-sm z-10 pointer-events-none">
                LIVE PREVIEW
            </div>
            
            <!-- Reusing the exact structure from index.html for fidelity -->
            <div class="min-h-screen p-8 flex justify-center items-start transform scale-90 origin-top">
                <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- Left Sidebar: Profile -->
                    <div class="md:col-span-1 space-y-6">
                        <div class="glass-card rounded-3xl p-6 text-center kawaii-shadow relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-24 bg-pink-100 opacity-50"></div>
                            
                            <div class="relative z-10 mt-4">
                                <img :src="profile.basicInfo.avatar" alt="Avatar" 
                                     class="w-32 h-32 rounded-full mx-auto border-4 border-white shadow-md object-cover">
                                
                                <h1 class="text-2xl font-bold mt-4 text-gray-800">{{ profile.basicInfo.nickname || '你的名字' }}</h1>
                                <p class="text-sm text-gray-500 mt-2 px-2">{{ profile.basicInfo.signature || '写一句签名吧...' }}</p>
                            </div>
        
                            <div class="mt-6 flex justify-center gap-3">
                                <div class="p-2 bg-pink-50 text-pink-400 rounded-full"><i data-lucide="heart" class="w-5 h-5"></i></div>
                                <div class="p-2 bg-blue-50 text-blue-400 rounded-full"><i data-lucide="message-circle" class="w-5 h-5"></i></div>
                                <div class="p-2 bg-purple-50 text-purple-400 rounded-full"><i data-lucide="share-2" class="w-5 h-5"></i></div>
                            </div>
                        </div>
        
                        <!-- Hobbies Section -->
                        <div class="glass-card rounded-3xl p-6 kawaii-shadow">
                            <h2 class="text-lg font-bold text-gray-700 mb-4 flex items-center gap-2">
                                <i data-lucide="star" class="w-5 h-5 text-yellow-400"></i>
                                我的爱好
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <span v-for="(hobby, index) in profile.hobbies" :key="index"
                                      class="px-3 py-1 bg-white border border-gray-100 rounded-full text-sm text-gray-600 shadow-sm">
                                    {{ hobby }}
                                </span>
                            </div>
                        </div>
                    </div>
        
                    <!-- Right Content: Mood Wall -->
                    <div class="md:col-span-2">
                        <div class="glass-card rounded-3xl p-6 kawaii-shadow h-full">
                            <h2 class="text-xl font-bold text-gray-700 mb-6 flex items-center gap-2">
                                <i data-lucide="cloud" class="w-6 h-6 text-blue-400"></i>
                                心情便利贴
                            </h2>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div v-for="mood in profile.moods" :key="mood.id"
                                     :class="['p-4 rounded-2xl transition-all duration-300 shadow-sm', mood.color || 'bg-white']">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-xs text-gray-500 font-medium bg-white/50 px-2 py-1 rounded-lg">
                                            {{ mood.date }}
                                        </span>
                                        <i data-lucide="pin" class="w-4 h-4 text-gray-400 opacity-50"></i>
                                    </div>
                                    <p class="text-gray-700 leading-relaxed">{{ mood.content }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
        
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted, nextTick, watch } = Vue;

        createApp({
            setup() {
                const profile = ref({
                    basicInfo: { nickname: '', avatar: '', signature: '' },
                    hobbies: [],
                    moods: []
                });

                // Load initial data
                const fetchData = async () => {
                    try {
                        const response = await fetch('data/profile.json');
                        if (response.ok) {
                            profile.value = await response.json();
                        }
                    } catch (e) {
                        console.log('Using default template');
                        profile.value = {
                            basicInfo: { nickname: 'Momo', avatar: '', signature: 'Hello World' },
                            hobbies: ['Coding'],
                            moods: []
                        };
                    }
                };

                const addHobby = () => profile.value.hobbies.push('新爱好');
                const removeHobby = (index) => profile.value.hobbies.splice(index, 1);
                
                const addMood = () => {
                    const today = new Date().toISOString().split('T')[0];
                    profile.value.moods.unshift({
                        id: Date.now(),
                        content: '',
                        date: today,
                        color: 'bg-pink-100'
                    });
                };
                const removeMood = (index) => profile.value.moods.splice(index, 1);

                const saveProfile = () => {
                    const dataStr = JSON.stringify(profile.value, null, 2);
                    const blob = new Blob([dataStr], { type: "application/json" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = "profile.json";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    alert('已下载 profile.json！\n请将其覆盖到项目的 data/ 目录下并提交到 GitHub。');
                };

                onMounted(() => {
                    fetchData();
                });

                // Re-render icons when DOM updates
                watch(profile, () => {
                    nextTick(() => lucide.createIcons());
                }, { deep: true });

                return {
                    profile,
                    addHobby,
                    removeHobby,
                    addMood,
                    removeMood,
                    saveProfile
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
